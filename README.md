# Market & Story

A curated retail and editorial platform — where shopping meets storytelling. Market & Story is a hybrid e-commerce storefront and content publication built with Next.js 16, powered by AI through a full RAG (Retrieval-Augmented Generation) pipeline for semantic search, product recommendations, and an intelligent chat assistant.

## Features

### Shopping

- **Product Catalog** — Browse products across categories (Home & Living, Fashion, Technology, Wellness, Accessories) with client-side filtering and sorting
- **Product Detail Pages** — Full product information with images, specs, customer reviews, and AI-powered "You Might Also Like" recommendations
- **Cart** — Client-side cart with localStorage persistence, quantity adjustment, and order summary
- **Wishlist** — Save products to a server-backed wishlist for later
- **Product Reels** — TikTok/Instagram-style vertical video feed showcasing products with swipe/scroll/keyboard navigation

### Editorial

- **Articles / Stories** — Full editorial content with structured sections (paragraphs, headings, blockquotes, inline product cards), filterable by category and tag
- **Reading List** — Save articles to a server-backed reading list
- **AI-Generated Summaries** — Each article gets an on-demand TL;DR summary generated by GPT-4o-mini

### AI / RAG Pipeline

Market & Story uses **Retrieval-Augmented Generation (RAG)** with OpenAI embeddings and PostgreSQL's `pgvector` extension for vector similarity search:

- **Semantic Search** — Search across both products and articles using vector similarity (`text-embedding-3-small`, 1536-dimension embeddings). Falls back to text-based search when embeddings are unavailable.
- **AI Chat Assistant** — A streaming chat interface powered by GPT-4o-mini with access to tools:
  - Search products and articles semantically
  - Get product details and comparisons
  - Add items to cart, wishlist, or reading list
  - Find trending products by category
  - Context-aware — knows the current page and cart contents
- **Related Stories** — Product pages show editorially related articles found via cross-table vector similarity (product embeddings vs. article embeddings)
- **Product Recommendations** — "You Might Also Like" suggestions based on embedding similarity between products
- **AI SEO Generation** — Offline script that generates meta titles, descriptions, and keywords for all products and articles

### Other

- **Account Dashboard** — Overview of wishlist, reading list, and review counts
- **Review System** — Submit and view customer reviews on product pages
- **About Page** — Static brand story page

## Tech Stack

| Layer | Technology |
|-------|------------|
| Framework | Next.js 16 (App Router, Server Components, Turbopack) |
| Language | TypeScript 5 (strict mode) |
| UI | React 18, Tailwind CSS v4, Shadcn/ui (new-york style), Radix UI |
| Database | PostgreSQL + pgvector extension |
| ORM | Prisma 6 |
| AI | OpenAI (`text-embedding-3-small`, `gpt-4o-mini`), Vercel AI SDK |
| Auth | NextAuth v5 (scaffolded, using demo user) |
| Icons | Lucide React |
| Forms | React Hook Form + Zod validation |
| Images | Cloudinary, Unsplash |

## Getting Started

### Prerequisites

- **Node.js** 20+
- **PostgreSQL** with the [`pgvector`](https://github.com/pgvector/pgvector) extension installed
- **OpenAI API key** for embeddings, chat, and AI features

### 1. Clone the repository

```bash
git clone https://github.com/your-username/market_and_story.git
cd market_and_story
```

### 2. Install dependencies

```bash
npm install
```

### 3. Set up environment variables

Create a `.env` file in the project root:

```env
# PostgreSQL connection string (must support pgvector)
DATABASE_URL="postgresql://user:password@localhost:5432/market_and_story"

# OpenAI API key (required for embeddings, chat, search, and summaries)
OPENAI_API_KEY="sk-..."

# NextAuth secret (required for authentication)
AUTH_SECRET="your-random-secret-here"

# Base URL (optional, defaults to http://localhost:3000)
NEXT_PUBLIC_BASE_URL="http://localhost:3000"
```

### 4. Enable pgvector in PostgreSQL

Connect to your database and run:

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

### 5. Set up the database

```bash
# Run migrations to create all tables
npm run db:migrate

# Seed the database with products, articles, reviews, and live content
npm run db:seed
```

### 6. Generate embeddings

This step calls the OpenAI API to generate vector embeddings for all products and articles. Required for semantic search, recommendations, and the chat assistant to work properly.

```bash
npm run seed:embeddings
```

### 7. (Optional) Generate AI SEO metadata

Generates meta titles, descriptions, keywords, and article summaries using GPT-4o-mini:

```bash
npm run generate:seo
```

### 8. Start the development server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

## Available Scripts

| Command | Description |
|---------|-------------|
| `npm run dev` | Start dev server with Turbopack |
| `npm run build` | Production build |
| `npm start` | Start production server |
| `npm run lint` | Run ESLint |
| `npm run lint:fix` | Auto-fix ESLint issues |
| `npm run db:migrate` | Run Prisma migrations |
| `npm run db:seed` | Seed the database |
| `npm run db:reset` | Reset and re-seed the database |
| `npm run db:studio` | Open Prisma Studio (database GUI) |
| `npm run seed:embeddings` | Generate OpenAI embeddings for all products and articles |
| `npm run generate:seo` | Generate AI-powered SEO metadata and article summaries |

## Project Structure

```
src/
├── app/
│   ├── (shop)/              # Route group: home, products, articles, about, etc.
│   │   ├── product/[slug]/  # Product detail pages
│   │   ├── articles/[id]/   # Article detail pages
│   │   ├── cart/            # Shopping cart
│   │   ├── wishlist/        # Saved products
│   │   ├── reading-list/    # Saved articles
│   │   ├── search/          # Semantic search
│   │   ├── account/         # User dashboard
│   │   └── product-reels/   # Video feed
│   ├── api/
│   │   ├── chat/            # AI chat assistant (streaming, tool use)
│   │   ├── search/          # Semantic search endpoint
│   │   ├── articles/[id]/summary/  # AI article summaries
│   │   ├── wishlist/        # Wishlist CRUD
│   │   ├── reading-list/    # Reading list CRUD
│   │   └── reviews/         # Review creation
│   ├── layout.tsx
│   └── globals.css
├── components/
│   ├── ui/                  # Shadcn/ui base components
│   ├── chat-assistant.tsx   # AI chat with product/article card rendering
│   ├── providers/           # Cart context provider
│   └── ...                  # Product, article, review components
├── lib/
│   ├── ai/                  # Embeddings, matching, SEO generation
│   ├── dal/                 # Data access layer (products, articles queries)
│   └── db.ts                # Prisma client singleton
├── seed/                    # Seed data (products, articles, live content)
└── helpers/
prisma/
├── schema.prisma            # Database schema with pgvector
├── seed.ts                  # Database seeding script
├── seed-embeddings.ts       # Embedding generation script
└── generate-seo.ts          # AI SEO generation script
```
